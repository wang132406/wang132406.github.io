
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·é£é™©è¯„ä¼°å°åŠ©æ‰‹ ğŸŒŸ</title>
    <!-- å¼•å…¥å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥å¯çˆ±å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* å…¨å±€æ ·å¼ - å¯çˆ±ç®€çº¦é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Neue', 'Noto Sans SC', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fdf2f8 0%, #fef7fb 100%);
            min-height: 100vh;
            padding: 20px 10px;
            color: #4a5568;
            line-height: 1.6;
        }
        
        /* ä¸»å®¹å™¨ - åœ†è§’å¡ç‰‡ + å¯çˆ±é˜´å½± */
        .container {
            max-width: 750px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 30px rgba(255, 182, 193, 0.2);
            overflow: hidden;
            border: 2px solid #fce4ec;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜æ  - ç²‰å«©æ¸å˜ */
        .header {
            background: linear-gradient(90deg, #ffc2d1 0%, #ffafcc 50%, #f9c7d4 100%);
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 26px;
            color: white;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 15px;
            color: #fff8f8;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* äººç¾¤é€‰æ‹©åŒºåŸŸ */
        .population-selector {
            padding: 25px 20px;
            background: #faf0f5;
            border-bottom: 1px solid #fce4ec;
        }
        
        .selector-title {
            font-size: 18px;
            color: #e53e3e;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 700;
        }
        
        .population-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .pop-btn {
            padding: 12px 20px;
            border: 2px solid #ffbbcc;
            border-radius: 50px;
            background: white;
            color: #e53e3e;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 180px;
            max-width: 220px;
        }
        
        .pop-btn:hover {
            background: #ffc2d1;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(255, 182, 193, 0.3);
        }
        
        .pop-btn.active {
            background: #e53e3e;
            color: white;
            border-color: #e53e3e;
        }
        
        /* è¡¨å•åŒºåŸŸ */
        .form-section {
            padding: 20px;
            display: none;
        }
        
        .form-title {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
            position: relative;
        }
        
        .form-title::after {
            content: "";
            display: block;
            width: 60px;
            height: 3px;
            background: #ffafcc;
            margin: 8px auto 0;
            border-radius: 3px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 15px;
            color: #2d3748;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .form-group label i {
            color: #ec4899;
            margin-right: 8px;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #fce4ec;
            border-radius: 16px;
            font-size: 16px;
            background: #fef7fb;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1);
            background: white;
        }
        
        .form-group input::placeholder {
            color: #d1d5db;
            font-size: 14px;
        }
        
        .required-mark {
            color: #ec4899;
            margin-left: 4px;
        }
        
        .optional-text {
            font-size: 12px;
            color: #9ca3af;
            margin-left: 8px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn-container {
            padding: 0 20px 30px;
            display: none;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #ec4899 0%, #db2777 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.2);
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(236, 72, 153, 0.3);
        }
        
        .calculate-btn:active {
            transform: translateY(0);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
            color: #ec4899;
            font-size: 16px;
        }
        
        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ç»“æœåŒºåŸŸ - å¯çˆ±å¡ç‰‡ */
        .result-section {
            margin: 0 20px 30px;
            padding: 25px;
            border-radius: 20px;
            display: none;
            animation: fadeIn 0.6s ease forwards;
            border: 2px solid #fce4ec;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-low {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fdf4 100%);
            border-color: #9ae6b4;
        }
        
        .result-medium {
            background: linear-gradient(135deg, #fffaf0 0%, #fef7fb 100%);
            border-color: #fcc367;
        }
        
        .result-high {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border-color: #fc8181;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .result-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .result-score {
            font-size: 30px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .result-low .result-score { color: #48bb78; }
        .result-medium .result-score { color: #ed8936; }
        .result-high .result-score { color: #e53e3e; }
        
        .result-level {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        /* æ–°å¢ï¼šæ…¢æ€§ç—…é£é™©æ ·å¼ */
        .disease-risk-section {
            background: white;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .disease-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .disease-title i {
            color: #ec4899;
        }
        
        .disease-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .disease-item {
            flex: 1;
            min-width: 180px;
            padding: 12px;
            border-radius: 12px;
            background: #f8f9fa;
            border-left: 4px solid #dee2e6;
        }
        
        .disease-item.low {
            border-left-color: #48bb78;
            background: #f0fdf4;
        }
        
        .disease-item.medium {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        
        .disease-item.high {
            border-left-color: #e53e3e;
            background: #fff5f5;
        }
        
        .disease-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .disease-risk {
            font-size: 13px;
            color: #718096;
        }
        
        .result-tips {
            line-height: 1.8;
            font-size: 15px;
            color: #4a5568;
            background: white;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .result-tips p {
            margin-bottom: 8px;
        }
        
        .result-tips strong {
            color: #2d3748;
        }
        
        /* åº•éƒ¨æç¤º */
        .footer {
            padding: 20px;
            text-align: center;
            font-size: 14px;
            color: #718096;
            background: #faf0f5;
            border-top: 1px solid #fce4ec;
        }
        
        /* å“åº”å¼é€‚é… */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 22px;
            }
            
            .pop-btn {
                min-width: 100%;
            }
            
            .result-score {
                font-size: 26px;
            }
            
            .disease-item {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="header">
            <h1>ğŸŒŸ å¥åº·é£é™©è¯„ä¼°å°åŠ©æ‰‹ ğŸŒŸ</h1>
            <p>å…ˆé€‰æ‹©æ‚¨çš„å¹´é¾„æ®µï¼Œå†å¡«å†™ä¸“å±å¥åº·ä¿¡æ¯ï½</p>
        </div>
        
        <!-- äººç¾¤é€‰æ‹©åŒºåŸŸ -->
        <div class="population-selector">
            <div class="selector-title">è¯·é€‰æ‹©æ‚¨çš„å¹´é¾„æ®µ ğŸ¯</div>
            <div class="population-buttons">
                <button class="pop-btn" id="btn-youth" onclick="selectPopulation('youth')">
                    <i class="fas fa-user-graduate"></i> é’å¹´ç»„ï¼ˆ18-44å²ï¼‰
                </button>
                <button class="pop-btn" id="btn-middle" onclick="selectPopulation('middle')">
                    <i class="fas fa-user-tie"></i> ä¸­å¹´ç»„ï¼ˆ45-59å²ï¼‰
                </button>
                <button class="pop-btn" id="btn-elderly" onclick="selectPopulation('elderly')">
                    <i class="fas fa-user-plus"></i> è€å¹´ç»„ï¼ˆ60å²åŠä»¥ä¸Šï¼‰
                </button>
            </div>
        </div>
        
        <!-- è¡¨å•åŒºåŸŸ -->
        <div class="form-section" id="form-area">
            <div class="form-title">å¡«å†™æ‚¨çš„å¥åº·ä¿¡æ¯ ğŸ“</div>
            <div id="form-content"></div>
            
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i> æ­£åœ¨å‡†å¤‡è¯„ä¼°...
            </div>
        </div>
        
        <!-- è®¡ç®—æŒ‰é’® -->
        <div class="btn-container" id="btn-container">
            <button class="calculate-btn" onclick="calculateRisk()">
                <i class="fas fa-heart"></i> è®¡ç®—æˆ‘çš„å¥åº·é£é™©
            </button>
        </div>
        
        <!-- ç»“æœåŒºåŸŸ -->
        <div class="result-section" id="result">
            <div class="result-header">
                <div class="result-emoji" id="result-emoji">ğŸ˜Š</div>
                <div class="result-score">é£é™©è¯„åˆ†ï¼š<span id="score">0</span> / 100</div>
                <div class="result-level" id="level">ä½é£é™©</div>
            </div>
            
            <!-- æ–°å¢ï¼šæ…¢æ€§ç—…é£é™©é¢„æµ‹åŒºåŸŸ -->
            <div class="disease-risk-section" id="disease-risk">
                <div class="disease-title">
                    <i class="fas fa-heartbeat"></i> æ…¢æ€§ç–¾ç—…é£é™©é¢„æµ‹
                </div>
                <div class="disease-list" id="disease-list">
                    <div class="disease-item">
                        <div class="disease-name">ğŸ¥ è¯·å…ˆå®Œæˆè¯„ä¼°</div>
                        <div class="disease-risk">å¡«å†™å¥åº·ä¿¡æ¯åå³å¯æŸ¥çœ‹è¯¦ç»†é£é™©</div>
                    </div>
                </div>
            </div>
            
            <div class="result-tips" id="tips">
                <p>è¯·é€‰æ‹©å¹´é¾„æ®µå¹¶å¡«å†™å¥åº·ä¿¡æ¯ï¼Œç‚¹å‡»è®¡ç®—æŒ‰é’®è·å–ä¸“å±å»ºè®®ï½</p>
            </div>
        </div>
        
        <!-- åº•éƒ¨æç¤º -->
        <div class="footer">
            <p>ğŸ’– æ¸©é¦¨æç¤ºï¼šæœ¬è¯„ä¼°ä»…ä¸ºå¥åº·å‚è€ƒï¼Œä¸æ„æˆåŒ»ç–—è¯Šæ–­å“¦ï½</p>
            <p>æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ ä»»ä½•ä¿¡æ¯</p>
        </div>
    </div>

    <script>
        // åˆ†äººç¾¤ç‰¹å¾é…ç½®ï¼ˆè‹±æ–‡åˆ—åï¼‰
        const populationConfig = {
            "youth": {
                "name": "é’å¹´ç»„ï¼ˆ18-44å²ï¼‰",
                "core_features": ['bmi', 'daily_steps', 'cholesterol', 'sleep_hours'],
                "optional_features": ['water_intake_l', 'calories_consumed'],
                "weight_rules": {
                    'bmi': 0.3, 'daily_steps': 0.4, 'cholesterol': 0.2, 'sleep_hours': 0.1
                }
            },
            "middle": {
                "name": "ä¸­å¹´ç»„ï¼ˆ45-59å²ï¼‰",
                "core_features": ['systolic_bp', 'cholesterol', 'bmi', 'age', 'resting_hr'],
                "optional_features": ['diastolic_bp', 'daily_steps'],
                "weight_rules": {
                    'systolic_bp': 0.35, 'cholesterol': 0.25, 'bmi': 0.2, 'age': 0.1, 'resting_hr': 0.1
                }
            },
            "elderly": {
                "name": "è€å¹´ç»„ï¼ˆ60å²åŠä»¥ä¸Šï¼‰",
                "core_features": ['systolic_bp', 'age', 'cholesterol', 'diastolic_bp'],
                "optional_features": ['resting_hr', 'sleep_hours'],
                "weight_rules": {
                    'systolic_bp': 0.35, 'age': 0.3, 'cholesterol': 0.25, 'diastolic_bp': 0.1
                }
            }
        };
        
        // ç‰¹å¾æ˜¾ç¤ºåæ˜ å°„ï¼ˆä»…ç”¨äºé¡µé¢å±•ç¤ºï¼‰
        const featureDisplay = {
            'age': 'å¹´é¾„ï¼ˆå²ï¼‰',
            'bmi': 'BMIæŒ‡æ•°',
            'daily_steps': 'æ¯æ—¥æ­¥æ•°',
            'sleep_hours': 'ç¡çœ æ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
            'water_intake_l': 'æ¯æ—¥é¥®æ°´é‡ï¼ˆLï¼‰',
            'calories_consumed': 'æ¯æ—¥æ‘„å…¥å¡è·¯é‡Œ',
            'resting_hr': 'é™æ¯å¿ƒç‡ï¼ˆæ¬¡/åˆ†é’Ÿï¼‰',
            'systolic_bp': 'æ”¶ç¼©å‹ï¼ˆmmHgï¼‰',
            'diastolic_bp': 'èˆ’å¼ å‹ï¼ˆmmHgï¼‰',
            'cholesterol': 'èƒ†å›ºé†‡ï¼ˆmmol/Lï¼‰'
        };
        
        // ç‰¹å¾è¾“å…¥éªŒè¯è§„åˆ™
        const validationRules = {
            'age': { min: 18, max: 120, type: 'number' },
            'bmi': { min: 10, max: 50, type: 'number', step: 0.1 },
            'daily_steps': { min: 0, max: 30000, type: 'number' },
            'sleep_hours': { min: 1, max: 24, type: 'number', step: 0.5 },
            'water_intake_l': { min: 0, max: 10, type: 'number', step: 0.1 },
            'calories_consumed': { min: 500, max: 5000, type: 'number' },
            'resting_hr': { min: 40, max: 150, type: 'number' },
            'systolic_bp': { min: 80, max: 200, type: 'number' },
            'diastolic_bp': { min: 40, max: 120, type: 'number' },
            'cholesterol': { min: 3.0, max: 20.0, type: 'number', step: 0.1 }
        };
        
        let selectedPopulation = "";
        
        // 1. é€‰æ‹©äººç¾¤å¹¶ç”Ÿæˆå¯¹åº”è¡¨å•
        function selectPopulation(popType) {
            // é‡ç½®æ‰€æœ‰æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.pop-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // æ¿€æ´»é€‰ä¸­æŒ‰é’®
            document.getElementById(`btn-${popType}`).classList.add('active');
            
            selectedPopulation = popType;
            const config = populationConfig[popType];
            
            // æ˜¾ç¤ºè¡¨å•åŒºåŸŸå’ŒæŒ‰é’®
            document.getElementById('form-area').style.display = 'block';
            document.getElementById('btn-container').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            // ç”Ÿæˆè¡¨å•å†…å®¹
            let formHTML = '';
            
            // ç”Ÿæˆæ ¸å¿ƒç‰¹å¾è¾“å…¥æ¡†ï¼ˆå¿…å¡«ï¼‰
            config.core_features.forEach(feature => {
                const rule = validationRules[feature];
                formHTML += `
                <div class="form-group">
                    <label for="${feature}">
                        <i class="fas fa-star"></i> ${featureDisplay[feature]}
                        <span class="required-mark">*</span>
                    </label>
                    <input 
                        type="number" 
                        id="${feature}" 
                        min="${rule.min}" 
                        max="${rule.max}" 
                        step="${rule.step || 1}"
                        placeholder="è¯·è¾“å…¥${featureDisplay[feature]}ï¼ˆ${rule.min}-${rule.max}ï¼‰"
                        required
                    >
                </div>
                `;
            });
            
            // ç”Ÿæˆå¯é€‰ç‰¹å¾è¾“å…¥æ¡†
            config.optional_features.forEach(feature => {
                const rule = validationRules[feature];
                formHTML += `
                <div class="form-group">
                    <label for="${feature}">
                        <i class="fas fa-circle"></i> ${featureDisplay[feature]}
                        <span class="optional-text">ï¼ˆå¯é€‰ï¼‰</span>
                    </label>
                    <input 
                        type="number" 
                        id="${feature}" 
                        min="${rule.min}" 
                        max="${rule.max}" 
                        step="${rule.step || 1}"
                        placeholder="è¯·è¾“å…¥${featureDisplay[feature]}ï¼ˆ${rule.min}-${rule.max}ï¼Œå¯é€‰ï¼‰"
                    >
                </div>
                `;
            });
            
            // æ’å…¥è¡¨å•å†…å®¹
            document.getElementById('form-content').innerHTML = formHTML;
        }
        
        // 2. éªŒè¯è¾“å…¥æ•°æ®
        function validateInputs(config) {
            const inputs = {};
            
            // éªŒè¯æ ¸å¿ƒç‰¹å¾
            for (const feature of config.core_features) {
                const input = document.getElementById(feature);
                const value = parseFloat(input.value);
                const rule = validationRules[feature];
                
                if (isNaN(value) || value < rule.min || value > rule.max) {
                    alert(`ğŸ’¡ è¯·è¾“å…¥æœ‰æ•ˆçš„${featureDisplay[feature]}ï¼ˆ${rule.min}-${rule.max}ï¼‰ï¼`);
                    input.focus();
                    return null;
                }
                inputs[feature] = value;
            }
            
            // è·å–å¯é€‰ç‰¹å¾ï¼ˆæ— å€¼åˆ™è®¾ä¸ºé»˜è®¤å€¼ï¼‰
            for (const feature of config.optional_features) {
                const input = document.getElementById(feature);
                const value = parseFloat(input.value);
                const rule = validationRules[feature];
                
                if (!isNaN(value) && value >= rule.min && value <= rule.max) {
                    inputs[feature] = value;
                } else {
                    // è®¾ç½®åˆç†é»˜è®¤å€¼
                    inputs[feature] = (rule.min + rule.max) / 2;
                }
            }
            
            return inputs;
        }
        
        // 3. è®¡ç®—é£é™©è¯„åˆ†ï¼ˆåŸºäºè‹±æ–‡åˆ—åæƒé‡ï¼‰
        function calculateRisk() {
            if (!selectedPopulation) {
                alert("ğŸ’¡ è¯·å…ˆé€‰æ‹©æ‚¨çš„å¹´é¾„æ®µï¼");
                return;
            }
            
            const config = populationConfig[selectedPopulation];
            const inputs = validateInputs(config);
            
            if (!inputs) return;
            
            // æ˜¾ç¤ºåŠ è½½
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            // æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿ
            setTimeout(() => {
                let score = 0;
                
                // æ ¹æ®ä¸åŒäººç¾¤çš„æƒé‡è§„åˆ™è®¡ç®—é£é™©åˆ†
                if (selectedPopulation === "youth") {
                    // é’å¹´ç»„è¯„åˆ†é€»è¾‘
                    score += calculateFeatureScore('bmi', inputs.bmi, [18.5, 23.9, 27.9]) * 0.3;
                    score += calculateFeatureScore('daily_steps', inputs.daily_steps, [5000, 10000, 15000], true) * 0.4;
                    score += calculateFeatureScore('cholesterol', inputs.cholesterol, [5.6, 6.1, 7.0]) * 0.2;
                    score += calculateFeatureScore('sleep_hours', inputs.sleep_hours, [6, 8, 10], true) * 0.1;
                } else if (selectedPopulation === "middle") {
                    // ä¸­å¹´ç»„è¯„åˆ†é€»è¾‘
                    score += calculateFeatureScore('systolic_bp', inputs.systolic_bp, [120, 140, 160]) * 0.35;
                    score += calculateFeatureScore('cholesterol', inputs.cholesterol, [5.6, 6.1, 7.0]) * 0.25;
                    score += calculateFeatureScore('bmi', inputs.bmi, [18.5, 23.9, 27.9]) * 0.2;
                    score += calculateFeatureScore('age', inputs.age, [45, 50, 55]) * 0.1;
                    score += calculateFeatureScore('resting_hr', inputs.resting_hr, [60, 80, 100]) * 0.1;
                } else if (selectedPopulation === "elderly") {
                    // è€å¹´ç»„è¯„åˆ†é€»è¾‘
                    score += calculateFeatureScore('systolic_bp', inputs.systolic_bp, [120, 140, 160]) * 0.35;
                    score += calculateFeatureScore('age', inputs.age, [65, 70, 80]) * 0.3;
                    score += calculateFeatureScore('cholesterol', inputs.cholesterol, [5.6, 6.1, 7.0]) * 0.25;
                    score += calculateFeatureScore('diastolic_bp', inputs.diastolic_bp, [80, 90, 100]) * 0.1;
                }
                
                // å½’ä¸€åŒ–åˆ°0-100åˆ†
                score = Math.min(100, Math.max(0, score));
                score = Math.round(score * 10) / 10;
                
                // è®¡ç®—æ…¢æ€§ç—…é£é™©
                const diseaseRisks = calculateDiseaseRisks(inputs, selectedPopulation);
                
                // è®¾ç½®ç»“æœ
                showResult(score, config.name, diseaseRisks);
                
                // éšè—åŠ è½½
                document.getElementById('loading').style.display = 'none';
                
            }, 1200);
        }
        
        // æ–°å¢ï¼šè®¡ç®—æ…¢æ€§ç—…é£é™©ï¼ˆé«˜è¡€å‹ã€ç³–å°¿ç—…ã€å¿ƒè¡€ç®¡ç—…ï¼‰
        function calculateDiseaseRisks(inputs, populationType) {
            const risks = {
                hypertension: { name: 'é«˜è¡€å‹', risk: 0, level: 'low' },
                diabetes: { name: 'ç³–å°¿ç—…', risk: 0, level: 'low' },
                cardiovascular: { name: 'å¿ƒè¡€ç®¡ç–¾ç—…', risk: 0, level: 'low' }
            };
            
            // 1. é«˜è¡€å‹é£é™©è®¡ç®—ï¼ˆä¸»è¦åŸºäºè¡€å‹ã€å¹´é¾„ã€BMIï¼‰
            let hypertensionRisk = 0;
            if (inputs.systolic_bp) {
                if (inputs.systolic_bp >= 160) hypertensionRisk += 40;
                else if (inputs.systolic_bp >= 140) hypertensionRisk += 25;
                else if (inputs.systolic_bp >= 120) hypertensionRisk += 10;
            }
            if (inputs.diastolic_bp) {
                if (inputs.diastolic_bp >= 100) hypertensionRisk += 20;
                else if (inputs.diastolic_bp >= 90) hypertensionRisk += 15;
                else if (inputs.diastolic_bp >= 80) hypertensionRisk += 5;
            }
            if (inputs.age) {
                if (inputs.age >= 60) hypertensionRisk += 20;
                else if (inputs.age >= 45) hypertensionRisk += 10;
            }
            if (inputs.bmi && inputs.bmi >= 28) hypertensionRisk += 15;
            
            // 2. ç³–å°¿ç—…é£é™©è®¡ç®—ï¼ˆä¸»è¦åŸºäºBMIã€å¹´é¾„ã€æ­¥æ•°ã€å¡è·¯é‡Œï¼‰
            let diabetesRisk = 0;
            if (inputs.bmi) {
                if (inputs.bmi >= 30) diabetesRisk += 30;
                else if (inputs.bmi >= 25) diabetesRisk += 20;
                else if (inputs.bmi >= 23.9) diabetesRisk += 10;
            }
            if (inputs.age) {
                if (inputs.age >= 60) diabetesRisk += 20;
                else if (inputs.age >= 45) diabetesRisk += 15;
            }
            if (inputs.daily_steps && inputs.daily_steps < 5000) diabetesRisk += 20;
            if (inputs.calories_consumed && inputs.calories_consumed > 3000) diabetesRisk += 15;
            
            // 3. å¿ƒè¡€ç®¡ç–¾ç—…é£é™©è®¡ç®—ï¼ˆä¸»è¦åŸºäºèƒ†å›ºé†‡ã€è¡€å‹ã€å¿ƒç‡ã€å¹´é¾„ï¼‰
            let cardiovascularRisk = 0;
            if (inputs.cholesterol) {
                if (inputs.cholesterol >= 7.0) cardiovascularRisk += 30;
                else if (inputs.cholesterol >= 6.1) cardiovascularRisk += 20;
                else if (inputs.cholesterol >= 5.6) cardiovascularRisk += 10;
            }
            if (inputs.systolic_bp && inputs.systolic_bp >= 140) cardiovascularRisk += 20;
            if (inputs.resting_hr && inputs.resting_hr >= 90) cardiovascularRisk += 15;
            if (inputs.age) {
                if (inputs.age >= 60) cardiovascularRisk += 20;
                else if (inputs.age >= 45) cardiovascularRisk += 10;
            }
            
            // å½’ä¸€åŒ–é£é™©å€¼å¹¶ç¡®å®šé£é™©ç­‰çº§
            risks.hypertension.risk = Math.min(100, Math.max(0, hypertensionRisk));
            risks.diabetes.risk = Math.min(100, Math.max(0, diabetesRisk));
            risks.cardiovascular.risk = Math.min(100, Math.max(0, cardiovascularRisk));
            
            // è®¾ç½®é£é™©ç­‰çº§ï¼ˆä½ï¼š<30ï¼Œä¸­ï¼š30-60ï¼Œé«˜ï¼š>60ï¼‰
            Object.keys(risks).forEach(key => {
                if (risks[key].risk >= 60) risks[key].level = 'high';
                else if (risks[key].risk >= 30) risks[key].level = 'medium';
                else risks[key].level = 'low';
                
                // ä¿ç•™ä¸€ä½å°æ•°
                risks[key].risk = Math.round(risks[key].risk * 10) / 10;
            });
            
            return risks;
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—å•ä¸ªç‰¹å¾çš„é£é™©åˆ†ï¼ˆ0-100ï¼‰
        function calculateFeatureScore(featureName, value, thresholds, isReverse = false) {
            let score = 0;
            
            if (isReverse) {
                // åå‘æŒ‡æ ‡ï¼ˆå€¼è¶Šå¤§é£é™©è¶Šä½ï¼šæ­¥æ•°ã€ç¡çœ ï¼‰
                if (value >= thresholds[2]) score = 0;
                else if (value >= thresholds[1]) score = 5;
                else if (value >= thresholds[0]) score = 15;
                else score = 25;
            } else {
                // æ­£å‘æŒ‡æ ‡ï¼ˆå€¼è¶Šå¤§é£é™©è¶Šé«˜ï¼šBMIã€è¡€å‹ã€èƒ†å›ºé†‡ï¼‰
                if (value >= thresholds[2]) score = 25;
                else if (value >= thresholds[1]) score = 15;
                else if (value >= thresholds[0]) score = 5;
                else score = 0;
            }
            
            return score * 4; // è½¬æ¢ä¸º0-100åˆ†åˆ¶
        }
        
        // æ˜¾ç¤ºè¯„ä¼°ç»“æœï¼ˆæ–°å¢æ…¢æ€§ç—…é£é™©å‚æ•°ï¼‰
        function showResult(score, populationName, diseaseRisks) {
            const resultDiv = document.getElementById('result');
            let level, emoji, tips, resultClass;
            
            // ç¡®å®šé£é™©ç­‰çº§
            if (score < 30) {
                level = "ğŸ‰ ä½é£é™©";
                emoji = "ğŸ˜Š";
                resultClass = "result-low";
                tips = `
                    <p>âœ¨ æ­å–œæ‚¨ï¼${populationName}å¥åº·é£é™©è¾ƒä½ï¼Œç»§ç»­ä¿æŒï½</p>
                    <p><strong>ä¸“å±å»ºè®®ï¼š</strong></p>
                    <p>1. ä¿æŒè§„å¾‹ä½œæ¯ï¼Œæ¯å¤©ä¿è¯7-8å°æ—¶ç¡çœ </p>
                    <p>2. åšæŒå½“å‰çš„è¿åŠ¨ä¹ æƒ¯ï¼Œæ¯æ—¥æ­¥æ•°å»ºè®®ä¿æŒ8000+</p>
                    <p>3. é¥®é£Ÿå‡è¡¡ï¼Œå¤šåƒè”¬èœæ°´æœï¼Œå‡å°‘é«˜æ²¹é«˜ç›é£Ÿç‰©</p>
                    <p>4. æ¯å¹´è¿›è¡Œä¸€æ¬¡å¸¸è§„ä½“æ£€ï¼Œå…³æ³¨æ ¸å¿ƒå¥åº·æŒ‡æ ‡</p>
                `;
            } else if (score < 60) {
                level = "âš ï¸ ä¸­é£é™©";
                emoji = "ğŸ˜";
                resultClass = "result-medium";
                tips = `
                    <p>ğŸ’¡ ${populationName}å¥åº·é£é™©ä¸ºä¸­ç­‰æ°´å¹³ï¼Œéœ€è¦ç¨åŠ æ³¨æ„ï½</p>
                    <p><strong>ä¸“å±å»ºè®®ï¼š</strong></p>
                    <p>1. æˆ’çƒŸé™é…’ï¼Œé¿å…é•¿æœŸç†¬å¤œå’Œè¿‡åº¦åŠ³ç´¯</p>
                    <p>2. æ§åˆ¶ä½“é‡ï¼Œæ¯æœˆå‡é‡1-2kgï¼ˆå¦‚æœ‰è¶…é‡/è‚¥èƒ–ï¼‰</p>
                    <p>3. æ¯åŠå¹´ç›‘æµ‹ä¸€æ¬¡æ ¸å¿ƒæŒ‡æ ‡ï¼ˆè¡€å‹ã€èƒ†å›ºé†‡ï¼‰</p>
                    <p>4. ä¿æŒè‰¯å¥½å¿ƒæ€ï¼Œé¿å…é•¿æœŸç„¦è™‘å’Œå‹åŠ›</p>
                `;
            } else {
                level = "ğŸ”´ é«˜é£é™©";
                emoji = "ğŸ˜Ÿ";
                resultClass = "result-high";
                tips = `
                    <p>â¤ï¸ ${populationName}å¥åº·é£é™©è¾ƒé«˜ï¼Œè¯·åŠ¡å¿…é‡è§†ï¼</p>
                    <p><strong>ä¸“å±å»ºè®®ï¼š</strong></p>
                    <p>1. ç«‹å³è°ƒæ•´ç”Ÿæ´»æ–¹å¼ï¼Œä¸¥æ ¼æ§åˆ¶é¥®é£Ÿï¼ˆä½ç›ã€ä½è„‚ã€ä½ç³–ï¼‰</p>
                    <p>2. å°½å¿«åˆ°åŒ»é™¢è¿›è¡Œå…¨é¢ä½“æ£€ï¼Œé‡ç‚¹æ£€æŸ¥æ ¸å¿ƒæŒ‡æ ‡</p>
                    <p>3. åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹åˆ¶å®šä¸ªæ€§åŒ–çš„è¿åŠ¨å’Œé¥®é£Ÿè®¡åˆ’</p>
                    <p>4. æ¯æœˆç›‘æµ‹æ ¸å¿ƒæŒ‡æ ‡ï¼Œå¿…è¦æ—¶éµåŒ»å˜±å¹²é¢„</p>
                `;
            }
            
            // æ›´æ–°ç»“æœæ˜¾ç¤º
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('result-emoji').textContent = emoji;
            document.getElementById('tips').innerHTML = tips;
            
            // æ–°å¢ï¼šæ›´æ–°æ…¢æ€§ç—…é£é™©æ˜¾ç¤º
            updateDiseaseRiskDisplay(diseaseRisks);
            
            // åº”ç”¨æ ·å¼
            resultDiv.className = "result-section";
            resultDiv.classList.add(resultClass);
            resultDiv.style.display = "block";
            
            // å¹³æ»‘æ»šåŠ¨åˆ°ç»“æœ
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // æ–°å¢ï¼šæ›´æ–°æ…¢æ€§ç—…é£é™©å±•ç¤º
        function updateDiseaseRiskDisplay(diseaseRisks) {
            const diseaseList = document.getElementById('disease-list');
            let diseaseHTML = '';
            
            // é«˜è¡€å‹
            diseaseHTML += `
            <div class="disease-item ${diseaseRisks.hypertension.level}">
                <div class="disease-name">ğŸ©¸ ${diseaseRisks.hypertension.name}</div>
                <div class="disease-risk">é£é™©æŒ‡æ•°ï¼š${diseaseRisks.hypertension.risk}/100 
                    (${diseaseRisks.hypertension.level === 'low' ? 'ä½é£é™©' : 
                      diseaseRisks.hypertension.level === 'medium' ? 'ä¸­é£é™©' : 'é«˜é£é™©'})
                </div>
            </div>
            `;
            
            // ç³–å°¿ç—…
            diseaseHTML += `
            <div class="disease-item ${diseaseRisks.diabetes.level}">
                <div class="disease-name">ğŸ¬ ${diseaseRisks.diabetes.name}</div>
                <div class="disease-risk">é£é™©æŒ‡æ•°ï¼š${diseaseRisks.diabetes.risk}/100 
                    (${diseaseRisks.diabetes.level === 'low' ? 'ä½é£é™©' : 
                      diseaseRisks.diabetes.level === 'medium' ? 'ä¸­é£é™©' : 'é«˜é£é™©'})
                </div>
            </div>
            `;
            
            // å¿ƒè¡€ç®¡ç–¾ç—…
            diseaseHTML += `
            <div class="disease-item ${diseaseRisks.cardiovascular.level}">
                <div class="disease-name">â¤ï¸ ${diseaseRisks.cardiovascular.name}</div>
                <div class="disease-risk">é£é™©æŒ‡æ•°ï¼š${diseaseRisks.cardiovascular.risk}/100 
                    (${diseaseRisks.cardiovascular.level === 'low' ? 'ä½é£é™©' : 
                      diseaseRisks.cardiovascular.level === 'medium' ? 'ä¸­é£é™©' : 'é«˜é£é™©'})
                </div>
            </div>
            `;
            
            diseaseList.innerHTML = diseaseHTML;
        }
        
        // å›è½¦æäº¤
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && selectedPopulation) {
                calculateRisk();
            }
        });
    </script>
</body>
</html>
    